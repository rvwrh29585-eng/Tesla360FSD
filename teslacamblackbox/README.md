# TeslaCam Blackbox

[**Use the hosted version â†’**](https://martyearthy.github.io/teslacamblackbox/)

A modern web-based tool for viewing Tesla Dashcam footage with integrated telemetry visualization. This application parses MP4 files directly in your browser, extracts the embedded SEI (Supplemental Enhancement Information) metadata, and overlays driving data in real-time. Yo.

## Features

- **Local Video Playback**: Uses the browser's native `VideoDecoder` API to play MP4 files frame-by-frame.
- **Privacy-First**: All processing happens locally in your browser. No video or telemetry data is uploaded to any server.
- **Telemetry Visualization**:
  - **Speed**: Current vehicle speed in MPH.
  - **Gear Indicator**: Park, Reverse, Neutral, Drive.
  - **Turn Signals**: Visual left/right indicators.
  - **Steering**: Real-time steering wheel rotation.
  - **Autopilot Status**: Indicators for Manual, TACC, Autosteer, and FSD.
  - **Pedals**: Visual feedback for accelerator position and brake application.
  - **Sensors**: Collapsible view for GPS coordinates (Lat/Lon), Heading, and G-force (XYZ acceleration).

https://x.com/MartyEarthy/highlights

## For Users

### How to Use
1. **Launch the App**: Open the `index.html` file in your browser. 
   > **Note**: Due to browser security restrictions on local files, you typically need to serve this file via a local web server (see below) rather than double-clicking it.
2. **Load Video**: Drag and drop a Tesla dashcam MP4 file onto the window, or click the drop zone to select a file.
3. **Playback**: 
   - Use the Play/Pause button or `Spacebar` to toggle playback.
   - Use the slider or `Left/Right Arrow` keys to scrub through the video.
   - Drag the floating dashboard overlay to position it anywhere on the video.
   - Click the chevron at the bottom of the dashboard to view detailed sensor data.

### Requirements
- A modern web browser (Chrome, Edge, Safari, Firefox) with support for the `VideoDecoder` API.
- MP4 files generated by a Tesla vehicle (HW3 or newer, firmware 2025.44.25+ for full SEI data support).

## For Developers

### Architecture

The application is built with vanilla HTML, CSS, and JavaScript, requiring no build step or complex framework.

- **`index.html`**: The application shell containing the video canvas and overlay DOM structure.
- **`style.css`**: Contains all styling, including dark mode UI and animations.
- **`script.js`**: The core application logic:
  - Initializes `protobuf.js` to define the SEI metadata structure.
  - Manages the UI state (play/pause, drag-and-drop, visualization updates).
  - Uses the `VideoDecoder` API to decode raw video frames.
  - Synchronizes frame rendering with metadata updates.
- **`dashcam-mp4.js`**: A utility class responsible for:
  - Parsing the MP4 container (finding atoms/boxes like `moov`, `mdat`).
  - Extracting raw H.264/AVC streams.
  - Parsing SEI NAL units from the video stream.
  - Stripping emulation prevention bytes from NAL units.
- **`dashcam.proto`**: The Protocol Buffers definition file used to decode the binary SEI payloads into readable JavaScript objects.

### Running Locally

Because the application uses `fetch` to load the `.proto` file and `VideoDecoder` which requires a secure context (or localhost), you must run it via a local web server.

**Python 3:**
```bash
python3 -m http.server
```

**Node.js (http-server):**
```bash
npx http-server .
```

Then open `http://localhost:8000` (or the port shown in your terminal).

### Dependencies

- **protobuf.js** (`vendor/protobuf.min.js`): Used for decoding the Protocol Buffer messages embedded in the SEI NAL units.
- **jszip** (`vendor/jszip.min.js`): Included for legacy/export compatibility (optional for the main player).

### Key Components

#### MP4 Parsing & SEI Extraction
The `DashcamMP4` class scans the MP4 file structure to locate the `mdat` atom containing the video data. It iterates through NAL units, looking for type 6 (SEI). When found, it passes the payload to the protobuf decoder defined by `dashcam.proto`.

#### Frame Synchronization
Instead of using a standard HTML `<video>` element (which doesn't expose frame-accurate metadata extraction easily), this app uses the WebCodecs `VideoDecoder` API. This allows:
1. Decoding frames manually.
2. Associating the exact SEI data package with the specific frame being rendered.
3. Drawing the frame to a `<canvas>` element.
